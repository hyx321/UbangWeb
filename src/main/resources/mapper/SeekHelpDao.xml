<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Configuration 3.0//EN" "mybatis-3-mapper.dtd" >
<mapper namespace="com.ubang.dao.SeekHelpDao">

	<!-- 获取校园风景图 -->
	<insert id="postHelp"
		parameterType="com.ubang.table.Help"> 
		    insert into 
		      help(help_type,help_startPosition,help_endPosition,help_content,help_taskId,help_date,isNormal)
			values
				(#{help_type},#{help_startPosition},#{help_endPosition},#{help_content},#{help_taskId},#{help_date},#{isNormal})
	</insert>
	
	<select id="getPerson"
		parameterType="java.lang.String"
		resultType="com.ubang.table.Person"> 
		    select 
		    	*
		    from
		    	person
		    where 
		    	phone like #{phone}
	</select>
	
	<select 
		id="helpList"
		parameterType="com.ubang.table.HelpInfoFilter"
		resultType="com.ubang.table.Help"> 
			select 
				*
			from 
				Help
			where 
				1=1
				<if test='helpTypeList.length >0 '>
					and 
					 isNormal in (${helpTypeList})	
	        	</if>
	        	<if test="helpSortList.length>0">
		        	and 
		        	help_type in ($helpSortList})	
	        	</if>
				<!-- #{start},#{space}  -->
	</select>
	
	<select 
		id="getAlarmContent"
		parameterType="java.lang.String"
		resultType="com.ubang.table.AlarmContent"> 
			select 
				*
			from 
				ubang_alarm_content
			where 
				user_phone like #{user_phone}
	</select>
		
		<update 
		id="ModifyAlarm"
		parameterType="com.ubang.table.AlarmContent"> 
			update
				ubang_alarm_content
			SET  
				alarm_content = #{alarm_content}
			where
				user_phone like #{user_phone} and number like #{number}
	</update>
	

	<insert id="PublishHelp"
		parameterType="com.ubang.table.HelpInfoUpdate"> 
		    insert into 
		      ubang_help_infomation(
		      		id,
		      		recourse,
		      		content,
		      		has_picture,
		      		start_position_lng,
		      		start_position_lat,
		      		end_position_lat,
		      		end_position_lng,
		      		create_time,
		      		type,
		      		status,
		      		has_rule,
		      		is_urgent)
			values(
				#{id},
				#{recourse},
				#{content},
				#{has_picture},
				#{start_position_lng},
				#{start_position_lat},
				#{end_position_lat},
				#{end_position_lng},
				str_to_date(#{create_time},'%Y-%m-%d %H:%i:%s'),
				#{type},
				#{status},
				#{has_rule},
				#{is_urgent})
	</insert>
	
	 <resultMap id="titleMapForUser" type="com.ubang.table.HelpInfoUpdate">
        <id column="id" property="id" jdbcType="INTEGER"/>
        <result column="recourse" property="recourse" jdbcType="INTEGER"/>
        <result column="content" property="content" jdbcType="VARCHAR"/>
        <result column="has_picture" property="has_picture" jdbcType="INTEGER"/>
        <result column="start_position_lng" property="start_position_lng" jdbcType="DOUBLE"/>
        <result column="start_position_lat" property="start_position_lat" jdbcType="DOUBLE"/>
        <result column="end_position_lat" property="end_position_lat" jdbcType="DOUBLE"/>
        <result column="end_position_lng" property="end_position_lng" jdbcType="DOUBLE"/>
        <result column="create_time" property="create_time" jdbcType="VARCHAR"/>
        <result column="type" property="type" jdbcType="VARCHAR"/>
        <result column="status" property="status" jdbcType="INTEGER"/>
        <result column="has_rule" property="has_rule" jdbcType="INTEGER"/>
        <result column="is_urgent" property="is_urgent" jdbcType="INTEGER"/>
    </resultMap>
    
	<select 
		id="GetMySeekHelp"
		parameterType="com.ubang.table.PersonSeekHelp"
		resultMap="titleMapForUser"> 
			select 
				*
			from 
				ubang_help_infomation
			where 
				recourse = #{userID} 
				<if test = 'status != 3'>
					and status = #{status}
				</if>
	</select>
	
	
	 <resultMap id="helpInfo" type="com.ubang.table.SeekHelpInfo">
        <id column="id" property="id" jdbcType="INTEGER"/>
        <result column="recourse" property="recourse" jdbcType="INTEGER"/>
        <result column="content" property="content" jdbcType="VARCHAR"/>
        <result column="has_picture" property="has_picture" jdbcType="INTEGER"/>
        <result column="start_position_lng" property="start_position_lng" jdbcType="DOUBLE"/>
        <result column="start_position_lat" property="start_position_lat" jdbcType="DOUBLE"/>
        <result column="end_position_lat" property="end_position_lat" jdbcType="DOUBLE"/>
        <result column="end_position_lng" property="end_position_lng" jdbcType="DOUBLE"/>
        <result column="create_time" property="create_time" jdbcType="VARCHAR"/>
        <result column="type" property="type" jdbcType="VARCHAR"/>
        <result column="has_rule" property="has_rule" jdbcType="INTEGER"/>
        <result column="is_urgent" property="is_urgent" jdbcType="INTEGER"/>
        <result column="nickname" property="nickname" jdbcType="INTEGER"/>
        <result column="avatar" property="avatar" jdbcType="VARCHAR"/>
    </resultMap>
    
	<select 
		id="GetSeekHelp"
		parameterType="com.ubang.table.PersonSeekHelp"
		resultMap="helpInfo"> 
			select 
				*
			from 
				ubang_help_infomation
			INNER JOIN 
				ubang_user
			where 
				recourse != #{userID} and recourse = ubang_user.id and status = #{status}
				
	</select>
	
</mapper>